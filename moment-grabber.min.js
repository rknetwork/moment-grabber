/*
	momentGrabber
	version : 0.1.7
	authors : Alex Galiyev
	license : MIT
	https://github.com/rknetwork/moment-grabber
*/

!function(e,t,a,m){"use strict";function n(t,a){this.element=e(t),this.options=e.extend({},d,a),this._defaults=d,this.init()}function o(t,a){var m=e("<div class='momentgrabber mg-days-view mg-unselectable'><div class='mg-calendar'><div class='mg-calendar-controls mg-flex-between'><button class='mg-left-arrow'>&larr;</button><select class='mg-calendar-month'></select><select class='mg-calendar-year'></select><button class='mg-right-arrow'>&rarr;</button></div><table><thead><tr class='mg-weekdays'></tr></thead><tbody></tbody></table></div><div class='mg-time mg-flex-around'><div class='mg-hours'><a class='mg-hours-up'>&#x25B2;</a><div class='mg-hours-text'>00</div><a class='mg-hours-down'>&#x25BC;</a></div><div class='mg-minutes'><a class='mg-minutes-up'>&#x25B2;</a><div class='mg-minutes-text'>00</div><a class='mg-minutes-down'>&#x25BC;</a></div><div class='mg-ampm'><a class='mg-ampm-change'>am</a></div></div></div>"),n=e("<div class='momentgrabber mg-months-view mg-unselectable'><div class='mg-calendar'><div class='mg-calendar-controls'><select class='mg-calendar-year'></select></div><table><tbody></tbody></table></div></div>");if("days"==a.view){var o=moment(t).date(1),d=moment(t).date(1).add(1,"month").subtract(1,"ms"),s=o.format("ddd")!==moment(o).weekday(0).format("ddd")?moment(o).weekday(0):o,i=d.format("ddd")!==moment(d).weekday(0).add(1,"week").subtract(1,"ms").format("ddd")?moment(d).weekday(0).add(1,"week").subtract(1,"ms"):d,r=moment.monthsShort();e.each(r,function(t){e(m).find(".mg-calendar-month").append(e("<option></option>").val(t).text(this))});for(h=a.minYear;h<=a.maxYear;h++)e(m).find(".mg-calendar-year").append(e("<option></option>").val(h).text(h));e(m).find(".mg-calendar-month").val(o.month()).end().find(".mg-calendar-year").val(o.format("YYYY"));var l=moment.weekdaysMin();e.each(l,function(){e(m).find(".mg-weekdays").append(e("<th></th>").text(this))});for(var g=0,c=moment(s);c.isBefore(i);c.add(1,"days"))0!=g&&7!=g||(f=e("<tr></tr>"),e(m).find("tbody").append(f),g=0),e(f).append(e("<td></td>").data("day",c.format("MD")).attr("data-day",c.format("MD")).text(c.format("D")).addClass("mg-day").addClass(!!c.isBefore(o)&&"mg-prev mg-grayedout").addClass(!!c.isAfter(d)&&"mg-next mg-grayedout").addClass(!(!a.minMoment||!c.isBefore(a.minMoment))&&"mg-disabled mg-grayedout")),g++;return m}if("months"==a.view){for(var s=moment(t).startOf("year"),i=moment(t).endOf("year"),h=a.minYear;h<=a.maxYear;h++)e(n).find(".mg-calendar-year").append(e("<option></option>").val(h).text(h));e(n).find(".mg-calendar-year").val(t.format("YYYY"));for(var f,p=0,c=moment(s);c.isBefore(i);c.add(1,"month"))0!=p&&3!=p||(f=e("<tr></tr>"),e(n).find("tbody").append(f),p=0),e(f).append(e("<td></td>").data("month",c.month()).attr("data-month",c.month()).text(c.format("MMMM")).addClass("mg-month").addClass(!(!a.minMoment||!c.isBefore(a.minMoment))&&"mg-disabled mg-grayedout")),p++;return n}}var n=n,d={timeScrollStepping:5,minYear:2010,maxYear:2050,minMoment:!1,position:!1,showTime:!0,view:"days",autoClose:!1};e.extend(n.prototype,{init:function(){var a=this;this.element.on("click",function(m){if(e(".momentgrabber:visible").remove(),""!==e(this).val()){n=moment(e(this).val(),"L LT",!1);e(a.element).data("mg",n)}else if(a.options.minMoment)n=moment(a.options.minMoment).add(a.options.timeScrollStepping,"m");else var n=moment();e(a.element).data("mg",n);var d=o(n,a.options);e(d).find(".mg-day[data-day="+n.format("MD")+"]").addClass("mg-selected-hl").end().find(".mg-hours-text").text(n.format("h")).end().find(".mg-minutes-text").text(n.format("mm")).end().find(".mg-ampm a").text(n.format("a")).addClass("mg-"+n.format("a"));var s=e(this).offset(),i=(e(this).outerWidth(),e(t).outerWidth(),e(this).outerHeight());e(d).find(".mg-time").toggle(a.options.showTime).end().appendTo("body").css({top:s.top+i+1,left:s.left}),a.options.position&&e(d).css({"margin-top":a.options.position.top,"margin-left":a.options.position.left}),e("html").click(function(t){0==e(t.target).closest(".momentgrabber").length&&e(".momentgrabber").remove()}),m.stopPropagation(),e(d).on("click",".mg-left-arrow, .mg-right-arrow",function(){var t=e(this).attr("class").split(" ")[0].replace("mg-",""),m=e(d).find(".mg-calendar-month").val(),n=e(d).find(".mg-calendar-year").val(),s=moment(e(a.element).data("mg")).year(n).month(m);"left-arrow"==t&&s.subtract(1,"month"),"right-arrow"==t&&s.add(1,"month");var i=o(s,a.options),r=e(i).find("tbody");e(d).find(".mg-calendar-month").val(s.month()).end().find(".mg-calendar-year").val(s.format("YYYY")).end().find("table tbody").replaceWith(e(r))}),e(d).on("change",".mg-calendar-month, .mg-calendar-year",function(){var t=e(this).attr("class").split(" ")[0].replace("mg-",""),m=e(d).find(".mg-calendar-month").val(),n=e(d).find(".mg-calendar-year").val(),s=moment(e(a.element).data("mg")).year(n).month(m),i=e(this).val();"calendar-month"==t&&s.month(i),"calendar-year"==t&&s.year(i);var r=o(s,a.options),l=e(r).find("tbody");e(d).find(".mg-calendar-month").val(s.month()).end().find(".mg-calendar-year").val(s.format("YYYY")).end().find("table tbody").replaceWith(e(l))}),e(d).on("click",".mg-day:not(.mg-disabled)",function(){var t=a.options.showTime?"L LT":"L",m=e(this).hasClass("mg-prev"),n=e(this).hasClass("mg-next"),o=moment(e(a.element).data("mg")),s=e(d).find(".mg-calendar-year").val(),i=e(d).find(".mg-calendar-month").val(),r=e(this).text(),l=e(a.element).data("mg")?e(a.element).data("mg"):moment();l.year(s).month(i),m&&l.subtract(1,"month"),n&&l.add(1,"month"),l.date(r),e(a.element).data("mg",l),e(a.element).val(l.format(t)),e(d).find(".mg-selected-hl").removeClass("mg-selected-hl").end(),e(this).addClass("mg-selected-hl"),e(a.element).trigger("mgUserChange",[l,o]),a.options.autoClose&&e(".momentgrabber").remove()}),e(d).on("click",".mg-month:not(.mg-disabled)",function(){var t=moment(e(a.element).data("mg")),m=e(d).find(".mg-calendar-year").val(),n=e(this).data("month"),o=e(a.element).data("mg")?e(a.element).data("mg"):moment();o.year(m).month(n),o.month(n),e(a.element).data("mg",o),e(a.element).val(o.format("L LT")),e(d).find(".mg-selected-hl").removeClass("mg-selected-hl").end(),e(this).addClass("mg-selected-hl"),e(a.element).trigger("mgUserChange",[o,t]),a.options.autoClose&&e(".momentgrabber").remove()}),e(d).on("click",".mg-hours-up, .mg-hours-down, .mg-minutes-up, .mg-minutes-down, .mg-ampm-change",function(){var t=e(this).attr("class").split(" ")[0].replace("mg-",""),m=e(a.element).data("mg")?e(a.element).data("mg"):moment(),n=moment(e(a.element).data("mg"));if("hours-up"==t&&m.add(1,"hours"),"hours-down"==t&&m.subtract(1,"hours"),"minutes-up"==t&&m.add(a.options.timeScrollStepping,"minutes"),"minutes-down"==t&&m.subtract(a.options.timeScrollStepping,"minutes"),"ampm-change"==t)var o="pm"==e(this).text()?"am":"pm",s=e(a.element).val().replace(/am|pm/i,o),m=moment(s,"L LT",!1);a.options.minMoment&&m.isSameOrBefore(a.options.minMoment)?e(a.element).data("mg",n):(e(a.element).data("mg",m),e(a.element).val(m.format("L LT")),e(d).find(".mg-selected-hl").removeClass("mg-selected-hl").end().find(".mg-day[data-day="+m.format("MD")+"]").addClass("mg-selected-hl").end().find(".mg-hours-text").text(m.format("h")).end().find(".mg-minutes-text").text(m.format("mm")).end().find(".mg-ampm a").text(m.format("a")).removeClass("mg-am mg-pm").addClass("mg-"+m.format("a")),e(a.element).trigger("mgUserChange",[m,n]))})}),this.element.on("change",function(t){var m=moment(e(this).val(),"L LT",!1),n=moment(e(this).data("mg"));a.options.minMoment&&m.isSameOrBefore(a.options.minMoment)?e(this).val(n.format("L LT")):(m.isValid()?e(this).val(m.format("L LT")):e(this).val(moment().format("L LT")),e(a.element).data("mg",m),e(a.element).trigger("mgUserChange",[m,n]))})},update:function(e){if(null==e)this.element.val(""),this.element.removeData("mg");else if(0==e);else{var t=this.options.showTime?"L LT":"L";this.element.val(e.format(t)),this.element.data("mg",e)}},setMinMoment:function(e){this.options.minMoment=e},setPosition:function(e){this.options.position=e}}),e.fn.momentgrabber=function(t){var a=Array.prototype.slice.call(arguments,1);return this.each(function(){var m=e(this),o=m.data("MomentGrabber");o?"string"==typeof t&&o[t].apply(o,a):m.data("MomentGrabber",new n(this,t))})}}(jQuery,window,document);